## Legacy Export Files ##

The legacy export contains the following files, in a zip file:

| Source XML | Size | Records | Analysis | Notes | 
| ---------- | ---- | ------- | -------- | ----- | 
| Area.xml | 40952 | 160 | Y | Local Area List | 
| Seniority_Audit.xml | TBD | TBD |  | Not yet received. Should map to HETS Seniority Audit table. | 
| Block.xml | 7635156 | 13563 |  |  | 
| Dump_Truck.xml | 7144372 | 6300 | Y | Review the number of populated records | 
| Equip.xml | 39524196 | 25287 |  |  | 
| Equip_Attach.xml | 10193366 | 37776 | Y | Can this data be merged to create a common list of Attachment types? | 
| Equip_Type.xml | 1329315 | 1887 | Y | Need to populate g;obal equipment type table and then a per district list, merging lists from Service Areas. | 
| Equip_Usage.xml | 52667405 | 95897 |  |  | 
| HETS_Audit.xml | 9222772 | 43392 | Y | Is there any data of value in this table? It appears not.| 
| HETS_City.xml | 13390 | 100 |  |  | 
| HETS_Shift.xml | 0 | 0 |  |  | 
| List_Resource.xml | 0 | 0 |  |  | 
| Owner.xml | 5020004 | 4836 |  |  | 
| Project.xml | 55070 | 159 | Y | Merge Service Area level data to District Level | 
| Rotation_Doc.xml | 10061865 | 26844 | Y | Could be used for populating RequestRotationList if the data is consistent enough. However - doesn't seem to be. | 
| Service_Area.xml | 24977 | 29 | Y | Verify matches existing data | 
| User_HETS.xml | 327273 | 889 | Y | Look at the different types of users in the system to enable populating group and role memberships. | 


# Mappings #

## Area ##

| Legacy Field    | New Object | New Field       | Notes |
| ------------    | ---------- | ---------       | ----- |
| Area_Id         | N/A        |                 | ID will be generated in new table.|
| Area_Cd         | LocalArea  | LocalAreaNumber                 |       |
| Area_Desc       | LocalArea  | Name            |       |
| Service_Area_Id | LocalArea  | ServiceArea     | Need to make FK to the Service Area table. | 
| Created_Dt      | LocalArea  | CreateTimestamp |       |
| Created_By      | LocalArea  | CreateUserid    |       |
|                 | LocalArea  | startDate       | Constant Date - Jan. 1, 2017 |
|                 | LocalArea  | endDate         | Constant Null |


## Block ##

| Legacy Field        | New Object | New Field       | Notes |
| ------------        | ---------- | ---------       | ----- |
| Area_Id             |            |                 |       |
| Equip_Type_Id       |            |                 |       |
| Block_Num           |            |                 |       |
| Cycle_Num           |            |                 |       |
| Max_Cycle           |            |                 |       |
| Last_Hired_Equip_Id |            |                 |       |
| Block_Name          |            |                 |       |
| Closed              |            |                 |       |
| Closed_Comments     |            |                 |       |
| Created_Dt          |            |                 |       |
| Created_By          |            |                 |       |

## Equip ##

| Legacy Field        | New Table | New Field          | Notes |
| ------------        | --------- | ---------          | ----- |
| Equip_Id            |           |
| Area_Id             | Equipment | LocalArea | Find FK in the HETS LocalArea table via the XML ID |
| Equip_Type_Id       | Equipment | EquipmentType | Find FK in the HETS DistrictEquipmentType Table via the XML ID |
| Owner_Popt_Id       | Equipment | Owner | Find FK in the HETS Owner Table via the XML ID |
| Equip_Cd            | N/A       |  | Primary Key will be generated by Postgres |
| Approved_Dt         | Equipment | ApprovedDate | |
| Received_Dt         | Equipment | ReceivedDate | |
| Addr1               |           |  | TBD - should we create a contact record for this? |
| Addr2               |           |  | |
| Addr3               |           |  | |
| Addr4               |           |  | |
| City                |           |  | |
| Postal              |           |  | |
| Block_Num           | Equipment | BlockNumber | TBD - need to see for the format of the BlockNumber |
| Comment             | Notes | Text | Need to link the new Note to the Equipment ID |
| Cycle_Hrs_Wrk       |  | | TBD - Need to look at the data.  Likely not needed. |
| Frozen_Out          |  | | Per the Business - not needed in the new HETS |
| Last_Dt             |  | | TBD - what is this field? Not in table definition we received. | 
| Licence             | Equipment | LicensePlate
| Make                | Equipment | Make
| Model               | Equipment | Model
| Year                | Equipment | Year
| Type                | Equipment | Type
| Num_Years           |  | | Calculated field in the new HETS - FY Start - ApprovedDate |
| Operator            | Equipment | Operator
| Pay_Rate            | Equipment | PayRate
| Project_Id          | | | Not tracked in the new HETS with the Equipment |
| Refuse_Rate         | | | Per the Business - field to be removed in new HETS |
| Seniority           | Equipment | Seniority
| Serial_Num          | Equipment | SerialNumber
| Size                | Equipment | Size
| Working             | Equipment | isHired | Field to be added - Defines when a piece of equipment has been hired. | 
| Year_End_Reg        | | | Per business - not needed in the new HETS |
| Prev_Reg_Area       | | | TBD - how to move a piece of equipment to a new area. |
| YTD                 | | | Calculated field in the new HETS - sum of work hours across Time Records. |
| YTD1                | Equipment | serviceHoursLastYear | |
| YTD2                | Equipment | serviceHoursTwoYearsAgo | |
| YTD3                | Equipment | serviceHoursThreeYearsAgo | |
| Status_Cd           | Equipment | Status | TBD - Need to look at old values |
| Archive_Cd          | Equipment | ArchiveCode |
| Archive_Reason      | Equipment | ArchiveReason |
| Reg_Dump_Trk        | 
| Created_Dt          | Equipment | CreateTimestamp
| Created_By          | Equipment | CreateUserid
| Modified_Dt         |
| Modified_By         |

## EquipAttach ##

NOTE: We would like to review the data to see about creating a global list of generic attachment types and linking the specific attachments for equipment
to those.  If a pattern is found, there will be a mapping developed between these records and the global list of attachments (which will be in a new HETS table).

NOTE: The combination "Equip_ID" + "Attach_Seq_Num" must be used as the "OldKey" in the ImportMap table.

| Legacy Field        | New Table           | New Field            | Notes |
| ------------        | ---------           | ---------            | ----- |
| Equip_Id            | EquipmentAttachment | Equipment | Find FK in the HETS Equipment Table via the XML ID |
| Attach_Seq_Num      | N/A |            | ID for the record will be generated by Postgres |
| Attach_Desc         | EquipmentAttachment | Description          |       |
| Created_Dt          | EquipmentAttachment | CreateTimestamp      |       |
| Created_By          | EquipmentAttachment | CreateUserid         |       |

## EquipType ##

*NOTE*: The HETS EQUIP_TYPE table contains a global, generic list of EQUIP_TYPES.  The HETS DISTRICT_EQUIPMENT_TYPE table will be the true target of the XML source. 

*Note*: The XML table is set at the Service Area level and in the new application, we would like it mapped at the District level, so a mapping is needed to apply that change. An interim, hand-constructed oldkey/newkey mapping may be needed to handle that.

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Equip_Type_Id          | 
| SubSystem_Id           | 
| Service_Area_Id        | DistrictEquipmentType       | District | Find FK in the HETS ServiceArea Table via the XML ID, then find the FK for the parent District of the service area.|
| Equip_Type_Cd          | DistrictEquipmentType       | Name
| Equip_Type_Desc        | DistrictEquipmentType       | Description
| Equip_Rental_Rate_No   |        | 
| Equip_Rental_Rate_Page |        | 
| Max_Hours              |        | 
| Extend_Hours           |        | 
| Max_Hours_Sub          |        | 
| Second_Blk             |        | 
| Created_Dt             |        | 
| Created_Dt             |        | 

## EquipUsage ##

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Equip_Id               | 
| Project_Id             |
| Service_Area_Id        | 
| Worked_Dt              | TimeRecord          | WorkedDate
| Entered_Dt             | TimeRecord          | EnteredDate
| Hours                  | TimeRecord          | Hours
| Rate                   | TimeRecord          | RentalAgreementRate
| Hours2                 | TimeRecord          | Hours
| Rate2                  | TimeRecord          | RentalAgreementRate
| Hours3                 | TimeRecord          | Hours
| Rate3                  | TimeRecord          | RentalAgreementRate
| Created_Dt             | TimeRecord          | CreateTimestamp
| Created_By             | TimeRecord          | CreateUserid

## HETS_Audit ##

*NOTE:* The XML for this table is empty, and it is unlikely that we will be able to use this data anyway - it's at too low a level.

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Created_By             |
| Created_Dt             |
| Action                 |
| Reason                 |

## HETS_City ##

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Service_Area_Id        |                     |                 |       |
| Seq_Num                |                     |                 |       |
|                        | City                | Id              | Generated by Postgres |
| City                   | City                | Name            |       |


## Owner ##

NOTE: The Owner XML file will generated a record in each of three tables during the process - one in Owner, one in Contact and one in Notes.

| Legacy Field             | New Table           | New Field       | Notes |
| ------------             | ---------           | ---------       | ----- |
| Popt_Id                  |
| Area_Id                  | Owner               | LocalArea
| Owner_Cd                 | Owner               | ownerEquipmentCodePrefix |
| Owner_First_Name         | Owner               | OrganizationName | Concatonate Owner_Last_Name + ", " + Owner_First_Name |
| Owner_Last_Name          | Owner               | OrganizationName
| Owner_First_Name         | Contact             | OrganizationName | Concatonate Owner_Last_Name + ", " + Owner_First_Name |
| Owner_Last_Name          | Contact             | OrganizationName, OwenrID to newkey, all other fields to NULL; Owner-> PrimaryContact  set to Contact newkey |
| Contact_Person           |                     | | TBD - Need to review the data to see if there is anything useful in this data element |
| Local_To_Area            |                | | We won't use this - a constant True will go into the "meetsResidency" field. |
| Maintenance_Contractor   | Owner               | IsMaintenanceContractor
| Comment                  | Notes               | Notes - other fields - OwnerID to NewKey, isNoLongerRelevant to FALSE |
| WCB_Num                  | 
| WCB_Expiry_Dt            |
| CGL_company              |
| CGL_Policy               |
| CGL_Start_Dt             |
| CGL_End_Dt               | Owner               | CGLEndDate
| Status_Cd                | Owner               | Status
| Archive_Cd               | Owner               | ArchiveCode
| Service_Area_Id          | 
| Selected_Service_Area_Id |
| Created_By               | Owner               |
| Created_Dt               | Owner               |
| Modified_By              | Owner               |
| Modified_Dt              | Owner               |



## Project ##

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Project_Id             |
| Service_Area_Id        | Project             | LocalArea
| Project_Num            | Project             | ProvincialProjectNumber 
| Job_Desc1              | Project             | Name
| Job_Desc2              | Project             | Notes
| Created_Dt             |                     | CreateTimestamp
| Created_By             | 

## Rotation_Doc ##

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Equip_Id               |
| Note_Dt                |
| Created_Dt             |
| Service_Area_Id        | 
| Project_Id             |
| Note_Type              |
| Reason                 |
| Note_Id                |
| Created_By             |

## Service_Area ##

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- |
| Service_Area_Id        | 
| Service_Area_Cd        | ServiceArea         | MinistryServiceAreaID
| Service_Area_Desc      | ServiceArea         | Name
| District_Area_Id       | ServiceArea         | District
| Last_Year_End_Shift    |                     |  
| Address                |                     |
| Phone                  |                     |
| Fax                    |                     | 
| FiscalStart            | ServiceArea         | StartDate
| FiscalEnd              |                     |
| Created_Dt             | ServiceArea         |       
| Created_By             | ServiceArea         | 

## User_HETS ##

| Legacy Field           | New Table           | New Field       | Notes |
| ------------           | ---------           | ---------       | ----- | 
| Popt_ID                | 
| Service_Area_Id        | User                | District
| User_Cd                | User                | SmUserId
| User_Cd                | User                | SmAuthorizationDirectory     
| Authority              | User                | UserRoles
| Default_Service_Area   | 
| Created_Dt             | User                |    
| Created_By             | User                |    
| Modified_Dt            | User                |
| Modified_By            | User                | 

# Flow #

- User starts the import process
- User selects the districts to import
- Cities are updated
- Service Areas in that district are updated
- Users in those service areas are imported / updated if the modified date is newer
- Projects in those service areas are imported
- Owners in those service areas are imported
- Equipment Types are updated
- Equipment in the service areas are imported